---
import Layout from '../layouts/Layout.astro';
import { Button } from "@nextui-org/react"
---

<Layout title="Welcome to Splithive">
    <main>
        <h1>Bienvenido a <span class="text-gradient">Splithive</span></h1>

        <h1>Lista de Grupos</h1>

        <div id="grupos"></div>

        <button id="crearGrupoBtn">Crear grupo</button>

        <div id="modal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close" id="closeModal">&times;</span>
                <h2>Crear Nuevo Grupo</h2>
                <form id="crearGrupoFormulario">
                    <label for="nombreGrupo">Nombre del grupo:</label>
                    <input type="text" id="nombreGrupo" name="nombreGrupo"><br><br>
                    
                    <label for="nombreIntegrante1">Nombre del integrante 1:</label>
                    <input type="text" id="nombreIntegrante1" name="nombreIntegrante1" value="Cami" disabled><br><br>

                    <div id="integrantesContainer"></div>

                    <button type="button" id="agregarIntegranteBtn">+</button><br><br>

                    <div style="margin-top: 10px;">
                        <button style="background-color: lightblue; border: 3px; border-color: black; border-radius: 5px; padding: 3px; color: black;" type="submit">Crear</button>
                        <button style="background-color: lightgrey; border: 3px; border-color: black; border-radius: 5px; padding: 3px; color: black;" id="cerrarFormBtn" type="button">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>

        <script>
            if (!sessionStorage.getItem('grupos')) {
                var grupos = [
                    { nombre: 'grupo1', integrantes: [{ nombre: 'Camila' }, { nombre: 'Mateo' }, { nombre: 'Ignacio' }, { nombre: 'Juan' }, { nombre: 'Manu' }, { nombre: 'Tomas' }], gastos: [ { nombre: "boleta de luz", deuda: 40, deudores: ["Tomas", "Manu", "Juan"] } ] },
                    { nombre: 'grupo2', integrantes: [{ nombre: 'Camila' }, { nombre: 'Raul' }, { nombre: 'Maria' }], gastos: [ { nombre: "supermercado", deuda: 100, deudores: ["Camila", "Maria"] }, { nombre: "colegio", deuda: 80, deudores: ["Raul"] } ] }
                ];
                sessionStorage.setItem('grupos', JSON.stringify(grupos));
            } else {
                var grupos = JSON.parse(sessionStorage.getItem('grupos'))
            }
            
            function actualizarListaGrupos() {
                var contenedorGrupos = document.getElementById('grupos');
                contenedorGrupos.innerHTML = ''; 

                grupos.forEach(function(grupo, i) {
                    var grupoElemento = document.createElement('div');

                    var cantidadIntegrantes = grupo.integrantes.length;
                    grupoElemento.innerHTML = '<h2>' + grupo.nombre + '</h2><p>Cantidad de integrantes: ' + cantidadIntegrantes + '</p>';

                    var enlaceDetalle = document.createElement('a');
                    enlaceDetalle.classList.add('grupo-card');
                    enlaceDetalle.href = 'grupos/' + (i + 1);
                    
                    enlaceDetalle.appendChild(grupoElemento);
                    contenedorGrupos.appendChild(enlaceDetalle);
                });
            }

            var modal = document.getElementById('modal');
            var btnAbrirModal = document.getElementById('crearGrupoBtn');
            var spanCerrar = document.getElementById('closeModal');

            btnAbrirModal.onclick = function() {
                modal.style.display = 'block';
            };

            spanCerrar.onclick = function() {
                modal.style.display = 'none';
            };

            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            };

            document.getElementById('crearGrupoBtn').addEventListener('click', function() {
                document.getElementById('crearGrupoForm').style.display = 'block';
            });

            document.getElementById('cerrarFormBtn').addEventListener('click', function() {
                document.getElementById('modal').style.display = 'none';
            });

            var contadorIntegrantes = 1; 

            document.getElementById('agregarIntegranteBtn').addEventListener('click', function() {
                contadorIntegrantes++; 
                var integrantesContainer = document.getElementById('integrantesContainer');
                var nuevoCampoIntegrante = document.createElement('div');
                nuevoCampoIntegrante.innerHTML = `<label for="nombreIntegrante${contadorIntegrantes}">Nombre del integrante ${contadorIntegrantes}:</label>
                                                <input type="text" id="nombreIntegrante${contadorIntegrantes}" name="nombreIntegrante${contadorIntegrantes}"><br><br>`;
                integrantesContainer.appendChild(nuevoCampoIntegrante);
            });

            document.getElementById('crearGrupoFormulario').addEventListener('submit', function(event) {
                event.preventDefault(); 

                var nombreGrupo = document.getElementById('nombreGrupo').value;
                var integrantes = [];
                for (var i = 1; i <= contadorIntegrantes; i++) {
                    var nombreIntegrante = document.getElementById(`nombreIntegrante${i}`).value;
                    integrantes.push({ nombre: nombreIntegrante });
                }

                var nuevoGrupo = { nombre: nombreGrupo, integrantes: integrantes, gastos: [] };

                grupos.push(nuevoGrupo);
                sessionStorage.setItem('grupos', JSON.stringify(grupos));

                actualizarListaGrupos();

                modal.style.display = 'none'; 
                document.getElementById('crearGrupoFormulario').reset();
            });

            actualizarListaGrupos();
        </script>
    </main>
</Layout>

<style is:global>
    #grupos {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
    }
    .grupo-card {
        background-color: honeydew;
        border-radius: 8px;
        padding: 20px;
        width: calc(33.33% - 20px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease-in-out;
        text-decoration: none;
        color: inherit;
    }
    .grupo-card:hover {
        transform: translateY(-5px);
    }
    .grupo-card h2 {
        margin-top: 0;
        color: black;
    }
    .grupo-card p {
        margin: 0;
        color: grey;
    }

    main {
		margin: auto;
		padding: 1rem;
		width: 800px;
		max-width: calc(100% - 2rem);
		color: white;
		font-size: 20px;
		line-height: 1.6;
	}
	.astro-a {
		position: absolute;
		top: -32px;
		left: 50%;
		transform: translatex(-50%);
		width: 220px;
		height: auto;
		z-index: -1;
	}
	h1 {
		font-size: 4rem;
		font-weight: 700;
		line-height: 1;
		text-align: center;
		margin-bottom: 1em;
        color: burlywood;
	}
	.text-gradient {
		background-image: var(--accent-gradient);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-size: 400%;
		background-position: 0%;
	}
	.instructions {
		margin-bottom: 2rem;
		border: 1px solid rgba(var(--accent-light), 25%);
		background: linear-gradient(rgba(var(--accent-dark), 66%), rgba(var(--accent-dark), 33%));
		padding: 1.5rem;
		border-radius: 8px;
	}
	.instructions code {
		font-size: 0.8em;
		font-weight: bold;
		background: rgba(var(--accent-light), 12%);
		color: rgb(var(--accent-light));
		border-radius: 4px;
		padding: 0.3em 0.4em;
	}
	.instructions strong {
		color: rgb(var(--accent-light));
	}
	.link-card-grid {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(24ch, 1fr));
		gap: 2rem;
		padding: 0;
	}
    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
        background-color: #fefefe;
        margin: 10% auto;
        padding: 20px;
        border-radius: 8px;
        width: 80%;
        max-width: 500px;
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    #crearGrupoBtn {
        background-color: #FFD93D; 
        color: black; 
        font-size: 20px;
        padding: 15px 30px; 
        margin-top: 40px;
    }

    #agregarIntegranteBtn {
        background-color: #F6F1E9;  
        color: black; 
    }

    #crearGrupoFormulario {
        margin-top: 40px;
    }

    label, h2, input {
        color: black;
    }

    input:disabled {
        background-color: transparent;
    }

    input {
        background-color: wheat; 
        border: 3px; border-color: black; 
        border-radius: 5px;
    }
</style>