---
import Layout from '../../layouts/Layout.astro';
import { bees } from '../../../public/bees.astro';
---

<Layout title="Welcome to Splithive">
    <main>
        <div class="container">
            <div style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 60%;
            margin-bottom: 1em;">
                <h1 class="text-gradient">Bees</h1> 
                <button id="newBeeBtn">New Bee</button>
            </div>
            <div class="contact-list">
                <!-- {contactos.map((contacto, index) => (
                    <a href={`/${contacto.usuario}`} class="contact-card" key={index}>
                        <p>{contacto.nombre}</p>
                    </a>
                ))} -->
            </div>
        </div>

        <div id="modal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close" id="closeModal">&times;</span>
                <h2>Add bee</h2>
                <form id="newBeeFormulario">
                    <label for="usuarioBee">User:</label>
                    <input type="text" id="usuarioBee" name="usuarioBee" minlength="2" required><br><br>
                    <!-- <button type="button" id="agregarDeudorBtn">+</button><br><br> -->
                    <div style="margin-top: 10px;">
                        <button style="background-color: lightblue; border: 3px; border-color: black; border-radius: 5px; padding: 3px; color: black;" type="submit">Add to hive</button>
                        <button style="background-color: lightgrey; border: 3px; border-color: black; border-radius: 5px; padding: 3px; color: black;" id="cerrarFormBtn" type="button">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <script>
import { bees } from "../../../public/bees.astro";

        var contactos = [];
        if (!sessionStorage.getItem('contactos')) {
            contactos = [
                    { nombre: 'Juan', usuario: 'juanito' }
                ];
            sessionStorage.setItem('contactos', JSON.stringify(contactos));
        } else {
            contactos = JSON.parse(sessionStorage.getItem('contactos'))
        }

        contactos.forEach((contacto, index) => {
            var card = document.createElement('a');
            card.href = `/${contacto.usuario}`;
            card.className = 'contact-card';
            card.innerHTML = `<p>${contacto.nombre}</p>`;
            document.querySelector('.contact-list').appendChild(card);
        });

        var modal = document.getElementById('modal');
        var btnAbrirModal = document.getElementById('newBeeBtn');
        var spanCerrar = document.getElementById('closeModal');

        btnAbrirModal.onclick = function() {
            modal.style.display = 'block';
        };

        spanCerrar.onclick = function() {
            modal.style.display = 'none';
        };

        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        };


        document.getElementById('cerrarFormBtn').addEventListener('click', function() {
            document.getElementById('modal').style.display = 'none';
        });

        document.getElementById('newBeeFormulario').addEventListener('submit', function(event) {
                event.preventDefault(); 

                var user = document.getElementById('usuarioBee').value;
                var nombre = "";
                var existe = false;
                bees.forEach((bee) => {
                    if (bee.usuario == user) {
                        existe = true;
                        nombre = bee.nombre;
                        return;
                    }
                });
                if (!existe) {
                    alert('El usuario no existe');
                    return;
                }
                
                var esContacto = false;
                contactos.forEach((contacto) => {
                    if (contacto.usuario == user) {
                        esContacto = true;
                    }
                });
                if (esContacto) {
                    alert('El usuario ya es un contacto');
                    return;
                }

                var nuevoContacto = { nombre: nombre, usuario: user };
                contactos.push(nuevoContacto);
                sessionStorage.setItem('contactos', JSON.stringify(contactos));

                modal.style.display = 'none'; 
                document.getElementById('newBeeFormulario').reset();
                location.reload();
            });
    </script>

    <style is:global>
        body {
        background-image: url('/public/fondo.jpeg'); 
        background-size: cover; 
        background-position: center; 
        height: 100vh; 
        }

        #newBeeBtn {
        background-color: #FFD93D; 
        color: black; 
        font-size: 20px;
        padding: 15px 30px; 
        }
    
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
    
        .text-gradient {
            font-size: 4rem;
            font-weight: 700;
            line-height: 1;
            text-align: center;
            background-image: linear-gradient(to right, #f12711, #f5af19);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    
        .contact-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }
    
        .contact-card {
            background-color: white;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            color: black;
            text-decoration: none;
            transition: transform 0.3s ease-in-out;
        }
    
        .contact-card:hover {
            transform: translateY(-5px);
        }

        .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 500px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</Layout>